name: ğŸš€ Deploy to Google Cloud Run (walldriyan)

on:
  push:
    branches:
      - main
    paths:
      - "financial_engine/**"
      - ".github/workflows/deploy.yml"
      - "cloudbuild.yaml"

env:
  PROJECT_ID: walldriyan-r-finance-engine # Screenshot à¶‘à¶šà·™à¶±à·Š à¶œà¶­à·Šà¶­ Project ID
  REGION: asia-south1
  SERVICE_NAME: walldriyan-r-financeeal-engine # Service Name (Spelling 'financeeal')

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: 'read'
      id-token: 'write' # For Workload Identity Federation (Preferred for enterprise)

    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # ğŸ” Auth Note: à¶”à¶¶à¶§ 'GCP_SA_KEY' Secret à¶‘à¶š GitHub Repo à¶‘à¶šà¶§ à¶‘à¶šà¶­à·” à¶šà·… à¶ºà·”à¶­à·”à¶º.
      - id: 'auth'
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.GCP_SA_KEY }}'

      - name: 'â˜ï¸ Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v1'

      # ğŸ”¥ Build & Deploy using cloudbuild.yaml trigger logic
      - name: 'ğŸš€ Build and Deploy via Cloud Build'
        run: |
          gcloud builds submit --config cloudbuild.yaml .
