/// ============================================================================
/// üîÑ Rounding (‡∑Ä‡∂ß ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏) - ‡∂∏‡∑ñ‡∂Ω‡∑ä‚Äç‡∂∫ ‡∑Ä‡∂ß ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏
/// ============================================================================
/// ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∑Ñ ‡∂∏‡∑ñ‡∂Ω‡∑ä‚Äç‡∂∫ ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∑í‡∑Ä‡∑í‡∂∞ ‡∑Ä‡∂ß ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏ ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑ö.
/// ‡∂Ö‡∂¥‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏ ‡∂ö‡∑í‡∑Ñ‡∑í‡∂¥‡∂∫‡∂ö‡∑ä ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä‡∂ß ‡∂±‡∂Ç‡∑Ä‡∂±‡∑ä‡∂±‡∑ô‡∂∏‡∑î.

use crate::core::money::Money;

#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum RoundingMode {
    /// ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫ ‡∑Ä‡∂ß ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ (Standard Nearest Neighbor)
    /// 0.5 ‡∑Ñ‡∑ù ‡∂ä‡∂ß ‡∑Ä‡∑ê‡∂©‡∑í ‡∂±‡∂∏‡∑ä ‡∂â‡∑Ñ‡∑Ö‡∂ß, ‡∂±‡∑ê‡∂≠‡∑ä‡∂±‡∂∏‡∑ä ‡∂¥‡∑Ñ‡∑Ö‡∂ß.
    Standard,

    /// ‡∑É‡∑ê‡∂∏‡∑Ä‡∑í‡∂ß‡∂∏ ‡∂â‡∑Ñ‡∑Ö‡∂ß (Ceiling / Round Up)
    /// ‡∑É‡∂≠‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂≠‡∑í‡∂∂‡∑ö ‡∂±‡∂∏‡∑ä ‡∂ä‡∑Ö‡∂ü ‡∂ª‡∑î‡∂¥‡∑í‡∂∫‡∂Ω‡∂ß ‡∑Ä‡∂ß ‡∂ö‡∂ª‡∂∫‡∑í.
    Up,

    /// ‡∑É‡∑ê‡∂∏‡∑Ä‡∑í‡∂ß‡∂∏ ‡∂¥‡∑Ñ‡∑Ö‡∂ß (Floor / Round Down)
    /// ‡∂â‡∂≠‡∑í‡∂ª‡∑í ‡∑É‡∂≠ ‡∂ú‡∂´‡∂± ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂∫‡∑í.
    Down,

    /// ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏‡∂∫ (Banker's Rounding / Round Half to Even)
    /// ‡∂∏‡∑ô‡∂∫ ‡∑É‡∂Ç‡∂õ‡∑ä‚Äç‡∂∫‡∑è ‡∂Ω‡∑ö‡∂õ‡∂± ‡∂Ø‡∑ù‡∑Ç ‡∂Ö‡∑Ä‡∂∏ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂∫‡∑í.
    /// ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß‡∂∏ ‡∂∏‡∑ê‡∂Ø (0.5) ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂ß ‡∑Ö‡∂ü‡∂∏ ‡∂á‡∂≠‡∑í ‡∂â‡∂ª‡∂ß‡∑ä‡∂ß‡∑ö ‡∑É‡∂Ç‡∂õ‡∑ä‚Äç‡∂∫‡∑è‡∑Ä‡∂ß ‡∑Ä‡∂ß ‡∂ö‡∂ª‡∂∫‡∑í.
    Bankers,
}

impl RoundingMode {
    /// üõ†Ô∏è ‡∂∏‡∑î‡∂Ø‡∂Ω‡∂ö‡∑ä ‡∑Ä‡∂ß ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    pub fn round(&self, amount: f64) -> Money {
        match self {
            RoundingMode::Standard => {
                Money::from_cents((amount * 100.0).round() as i64)
            },
            RoundingMode::Up => {
                Money::from_cents((amount * 100.0).ceil() as i64)
            },
            RoundingMode::Down => {
                Money::from_cents((amount * 100.0).floor() as i64)
            },
            RoundingMode::Bankers => {
                // ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏‡∂∫ (Banker's rounding)
                // Rust ‡∑Ä‡∂Ω `round_tiest_even` ‡∂∏‡∑ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑í‡∂∫‡∑í
                let cents = (amount * 100.0).round_ties_even() as i64;
                Money::from_cents(cents)
            }
        }
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_rounding() {
        let val = 10.555; // Rs. 10.555
        
        let r_std = RoundingMode::Standard.round(val);
        assert_eq!(r_std.amount, 1056); // 10.56

        let r_down = RoundingMode::Down.round(val);
        assert_eq!(r_down.amount, 1055); // 10.55

        let r_up = RoundingMode::Up.round(val);
        assert_eq!(r_up.amount, 1056); //  10.56
    }
}
