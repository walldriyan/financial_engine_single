use crate::types::cart::Cart;
use crate::core::errors::EngineResult;
use crate::core::money::Money;

/// ============================================================================
/// ðŸ”Œ Rule Traits (à¶»à·“à¶­à·’ à¶œà·”à¶«à·à¶‚à¶œ) - Pluggable Architecture
/// ============================================================================
/// à¶•à¶±à·‘à¶¸ à¶šà·™à¶±à·™à¶šà·”à¶§ à¶­à¶¸à¶±à·Šà¶œà·šà¶¸ à¶»à·“à¶­à·’ à¶‘à¶±à·Šà¶¢à·’à¶¸à¶§ à¶‡à¶­à·”à·…à¶­à·Š à¶šà·’à¶»à·“à¶¸à¶§ à¶¸à·™à¶º à¶‰à¶© à¶¯à·™à¶ºà·’.

pub enum RuleAction {
    /// à¶¸à·’à¶½ à¶…à¶©à·” à¶šà·’à¶»à·“à¶¸à¶šà·Š (Discount)
    Discount(Money),
    
    /// à¶¶à¶¯à·Šà¶¯à¶šà·Š (Tax)
    Tax(Money),
    
    /// à¶œà·à·ƒà·Šà¶­à·”à·€à¶šà·Š à¶‘à¶šà¶­à·” à¶šà·’à¶»à·“à¶¸à¶šà·Š (Surcharge/Fee)
    Fee(Money),
    
    /// à¶±à·œà¶¸à·’à¶½à·š à¶·à·à¶«à·Šà¶©à¶ºà¶šà·Š (Free Item)
    FreeItem { item_id: String, qty: f64 },
}

pub trait Rule {
    /// à¶»à·“à¶­à·’à¶ºà·š à¶±à¶¸ (Name)
    fn name(&self) -> &str;
    
    /// à¶»à·“à¶­à·’à¶º à¶šà·Šâ€à¶»à·’à¶ºà·à¶­à·Šà¶¸à¶š à¶šà·… à·„à·à¶šà·’à¶¯? (Can apply?)
    fn can_apply(&self, cart: &Cart) -> bool;
    
    /// à¶»à·“à¶­à·’à¶º à¶šà·Šâ€à¶»à·’à¶ºà·à¶­à·Šà¶¸à¶š à¶šà¶»à¶±à·Šà¶± (Apply)
    fn apply(&self, cart: &Cart) -> EngineResult<Vec<RuleAction>>;
    
    /// à¶´à·Šâ€à¶»à¶¸à·”à¶›à¶­à·à·€à¶º (Priority) - à·€à·à¶©à·’ à¶…à¶œà¶ºà¶šà·Š à¶¸à·”à¶½à·’à¶±à·Š à¶šà·Šâ€à¶»à·’à¶ºà·à¶­à·Šà¶¸à¶š à·€à·š
    fn priority(&self) -> i32;
}
